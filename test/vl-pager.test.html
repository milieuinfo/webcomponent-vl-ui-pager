<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <script src="../../@webcomponents/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../web-component-tester/browser.js"></script>

  <script type="module" src="../vl-pager.src.js"></script>
</head>

<body>
<test-fixture id="vl-pager-fixture">
  <template>
    <vl-pager total-items="100" items-per-page="10" current-page="1"></vl-pager>
  </template>
</test-fixture>

<script>
  suite('vl-pager', () => {
    const should = chai.should();

    setup((done) => {
      customElements.whenDefined('vl-pager').then(done);
    });

    test('bevat een container met de juiste class zodat de stijl goed toegepast wordt', () => {
      const pager = fixture('vl-pager-fixture');
      assert.isTrue(pager._element.classList.contains("vl-pager"));
    });

    test('de component bevat de juiste data', () => {
      const pager = fixture('vl-pager-fixture');
      assert.equal(pager.totalPages, 10);
      assert.equal(pager.totalItems, 100);
      assert.equal(pager.currentPage, 1);
      assert.equal(pager.itemsPerPage, 10);
      assert.equal(pager._firstItemNrOfPage, 1);
      assert.equal(pager._lastItemNrOfPage, 10);
    });

    test('gebruik "current-page" attribuut om te bladeren', () => {
      const pager = fixture('vl-pager-fixture');
      pager.setAttribute("current-page", 2);
      flush(() => {
        assert.equal(pager.totalPages, 10);
        assert.equal(pager.totalItems, 100);
        assert.equal(pager.currentPage, 2);
        assert.equal(pager.itemsPerPage, 10);
        assert.equal(pager._firstItemNrOfPage, 11);
        assert.equal(pager._lastItemNrOfPage, 20);
      });
    });

    test('deling met de rest', (done) => {
      const pager = fixture('vl-pager-fixture');
      pager.setAttribute("current-page", 2);
      pager.setAttribute("total-items", 199);
      pager.setAttribute("items-per-page", 99);
      flush(() => {
        assert.equal(pager.currentPage, 2);
        assert.equal(pager.totalPages, 3);
        assert.equal(pager.totalItems, 199);
        assert.equal(pager.itemsPerPage, 99);
        assert.equal(pager._firstItemNrOfPage, 100);
        assert.equal(pager._lastItemNrOfPage, 198);
        done();
      });
    });

    test('forward-button verandert de "current-page" attribuut en triggert "changed" event', (done) => {
      const pager = fixture('vl-pager-fixture');
      pager.addEventListener('pagechanged', () => {
        assert.equal(pager.currentPage, 2);
        done();
      });
      pager.shadowRoot.querySelector("#pageForwardLink").click();
    });

    test('backward-button verandert de "current-page" attribuut en triggert "changed" event', (done) => {
      const pager = fixture('vl-pager-fixture');
      pager.setAttribute("current-page", 2);
      flush(() => {
        pager.addEventListener('pagechanged', () => {
          assert.equal(pager.currentPage, 1);
          done();
        });
        pager.shadowRoot.querySelector("#pageBackLink").click();
      });
    });

    test('de pager is onzichtbare als de attribute totaal-items gelijk aan 0',(done) => {
      const pager = fixture('vl-pager-fixture');
      pager.setAttribute("total-items",0);
      flush(() => {
        assert.equal(pager.style.display,"none");
        done();
      })
    });

    test('de backward-button is onzichtbare als de attribute current-page gelijk aan 1',(done) => {
      const pager = fixture('vl-pager-fixture');
      pager.setAttribute("current-page",1);
      flush(() => {
        assert.equal(pager._pageBackListItem.style.display,"none");
        assert.notEqual(pager._pageForwardListItem.style.display,"none");
        done();
      })
    });

    test('de forward-button is onzichtbare als de pager al op de laatste pagina zet',(done) => {
      const pager = fixture('vl-pager-fixture');
      pager.setAttribute("current-page",10);
      flush(() => {
        assert.notEqual(pager._pageBackListItem.style.display,"none");
        assert.equal(pager._pageForwardListItem.style.display,"none");
        done();
      })
    })
  });
</script>
</body>

</html>
